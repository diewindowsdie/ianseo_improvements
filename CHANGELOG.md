# Список изменений относительно коробочной, "ванильной" версии IANSEO rev 26:

## Изменения отчета "Результаты квалификационного раунда (индивидуальный)":
* Изменено соотношение размеров полей - ширина поля "Регион/Команда" увеличена
* В поле "Регион/Команда" не выводится код региона, а через запятую выводится первый и второй указанный для участника регион
* Добавлено поле с датой рождения спортсмена
* В поле "Разряд" выводится описание (не код, как было из коробки) текущего имеющегося спортивого разряда/звания спортсмена (см. ниже общее описание работы с имеющимися разрядами)
* Убрано поле с классом/возрастным классом спортсмена (U18M, U21W и т.д.)
* Добавлено поле с выполненным нормативом (см. общее описание работы с нормативами ниже)
* В конце отчета добавлен блок с подписями, именами и судейскими категориями судей ГСК (см. общее описание работы с судьями ГСК ниже)
* В том случае если последняя группа+дивизион в отчете расположена так, что подписи ГСК и блок с легендой не помещаются, последняя группа+дивизион переносится на новую страницу
* В конце отчета в блок легенды добавлено описание статусов DNS, DNF, DSQ, DQB

## Изменения отчета "Отборочный и финальный этап - сетки и ранги (индивидуальный)":
* Локализован вывод номеров щитов - теперь они выглядят так: "Щит 2"/"Щит 3А" и т. д.
* Таблицы с финальными рангами теперь выводятся одна за другой, больше не выводятся по одной группе/дивизиону на страницу
* Перед первой таблицей добавлен заголовок "Итоговые результаты"
* В таблицах с итоговыми результатами изменено соотношение размеров полей - ширина поля "Регион/Команда" увеличена, также увеличена ширина ячеек под результаты каждого поединка
* Для классиков, занявших с 5 по 8 место, сумма результатов попаданий в поединке теперь выводится справа от количества очков в поединке
* В таблицах с итоговыми результатами выводятся результаты перестрелок в каждом поединке (были только за золото и бронзу)
* В таблицах с итоговыми результатами в поле "Регион/Команда" не выводится код региона, а через запятую выводится первый и второй указанный для участника регион
* При выводе результатов перестрелок при одинаковых попаданиях теперь выводится "+" рядом с тем результатом, который был ближе к центру
* После таблиц с итоговыми результатами добавлен блок с подписями, именами и судейскими категориями судей ГСК (см. общее описание работы с судьями ГСК ниже)
* В случае, если последняя таблица с итоговыми результатами расположена так, что подписи ГСК окажутся на другой странице, последняя таблица с итоговыми результатами переносится на новую страницу

## Изменения отчета "Список медалистов":
* Изменено соотношение ширины полей - уменьшена ширина полей "Дата", "Медаль" и "Спортсмен", и увеличена ширина поля "Команда/Регион"
* В поле "Регион/Команда" не выводится код региона, а через запятую выводится первый и второй указанный для участника регион
* В конце отчета добавлен блок с подписями, именами и судейскими категориями судей ГСК (см. общее описание работы с судьями ГСК ниже)
* Локализован заголовок отчета - выводится "Список победителей и призеров"

## Изменения отчета "Список спортсменов по мишеням"
* Добавлен заголовок "Протокол жеребьёвки"
* Убрано поле с идентификатором спортсмена
* Добавлено поле с датой рождения спортсмена
* В поле "Регион/Команда" не выводится код региона, а через запятую выводится первый и второй указанный для участника регион. Также, название региона больше не пишется полностью заглавными буквами.
* В полях "Класс" и "Дивизион" выводятся заданные в настройках соревнования значения, вместо кодов.
* В поле "Разряд" выводится описание (не код, как было из коробки) текущего имеющегося спортивого разряда/звания спортсмена (см. ниже общее описание работы с имеющимися разрядами)

## Изменения отчета "Полное расписание"
* Локализованы заголовки отчета: "Программа соревнований" и "Расписание"
* Локализованы даты в заголовке отчета - дата соревнования форматируется без английского сокращенного названия месяца

## Прочие изменения
* Изменена локализация полей в настройках классов/дивизионов - поля для ввода максимального и минимального возраста возрастного класса называются теперь "Мин. возраст" и "Макс. возраст"
* Добавлена поддержка двойных кавычек в названиии стран, клубов и команд. Одинарные кавычки не поддерживаются.

## Работа с судьями ГСК
* Локализованы названия должностей судей ГСК - "Главный судья", "Заместитель главного судьи", "Главный секретарь".
* Блок для подписей судей ГСК строится на основании информации, указанной в настройках соревнования: Соревнование -> Изменить инф. о турнире -> Судейская коллегия.
* Необходимо добавить трех судей, при этом совершая некоторые неочевидные действия:
  + В поля "Номер" и "Local BIB" необходимо указывать номера, которые не используются для других участников соревнования (спортсменов). Например, начать номера судей с 1, а спортсменов, при импорте данных в IANSEO, с 100, или наоборот, начать нумерацию спортсменов с 1, а судей с 10000.
  + В поле "Фамилия" необходимо указать фамилию и инициалы судьи
  + В поле "Имя" необходимо указать судейскую категорию судьи
* Остальные поля заполняются интуитивно понятно. Рекомендуется в качестве кода региона использовать тот же код, что используется для этого региона у спортсменов.

## Работа с имеющимися спортивными разрядами и званиями спортсменов
* В настройках соревнования: Соревнование -> Изменить инф. о турнире -> Разряд/Звание необходимо внести латиницей коды имеющихся разрядов и кириллицей их описание (для отчета с квалификации), при этом не забывая указывать порядок. В каком порядке они добавлены, значения не имеет, главное чтобы значения в поле "Порядок" не повторялись.
* Пример пар ключ-значение (жирным выделен ключ):
  + **1**	1
  + **2**	2
  + **3**	3
  + **1U**  1ю
  + **2U**  2ю
  + **3U**  3ю
  + **K**	КМС
  + **M**	МС
  + **MM**	МСМК
  + **Z**	ЗМС
* После того как были добавлены коды и описания разрядов, эти коды необходимо использовать при импорте данных спортсменов в IANSEO. Обращаю внимание, именно коды, а не значения. Если все сделано верно - данные появятся в отчете с квалификации.

## Работа с выполненными нормативами
* Спортивные нормативы гибко настраиваются. На данный момент поддерживаются нормативы для упражнения 18м+18м и 12м+12м.
* Для добавления поддержки нормативов для других упражнений:
  + Найти папку ***Common/Normative/conf***, в которой лежат файлы с настройками.
  + Определить уникальную для данного набора дистанций строку: для этого необходимо проверить, как для выбранного упражнения в IANSEO называются дистанции. Например: для 18м+18м это **18m-1** и **18m-2**. Имя файла должно быть соединением этих названий через символ подчеркивания "_", с заменой дефисов "-" на символ подчеркивания "_". Получаем строку "**18m_1_18m_2**" (без кавычек).
  + Создать файл с корректным именем: к полученной ранее строке нужно добавить "**Provider**" спереди и "**.inc.php**" (без кавычек) сзади. В нашем примере получится имя файла "**Provider18m_1_18m_2.inc.php**".
  + Внутри этого файла необходимо написать на PHP класс, реализующий интерфейс ***NormativeProvider***. Имя этого класса должно начинаться со слова "**Provider**" (без кавычек), к которому необходимо дописать справа строку, полученную ранее. Для нашего примера получим "**Provider18m_1_18m_2**". Другой пример: для упражнения М-1 для мужчин это будет "**Provider90m_70m_50m_30m**".
  + В этом классе необходимо реализовать функцию ***calculateNormativeInternal***, принимающую три параметра: ***\$class***, ***\$division***, ***\$score***. Сигнатуру функции можно копировать из имеющихся реализаций. Эта функция и осуществляет определение выполненного норматива.
  + В поле ***$division*** будет идентификатор дивизиона, указанный в настройках соревнования, обычно это **R** для классического лука, **С** (латинская) для блочного лука, **B** для баребоу, и т.д.
  + В поле ***$class*** будет класс, в который входит возрастная категория и пол лучника, как было указано в настройках соревнования. Обычно это может быть **U18M** - для юноши, **U21W** - для юниорки, **M** для мужчины.
  + В поле ***$score*** будет число с результатом лучника.
  + На основании этих данных необходимо рассчитать выполненный норматив. Обращаем внимание на то, что для некоторых упражнений нормативы не присваиваются некоторым категориям лучников. Например, на "женском" М-1 - 70+60+50+30, который также стреляют юноши, мужчинам разряды и звания не присваиваются, а нормативы для юношей и женщин отличаются.
  + В случае, если выполнен норматив, необходимо вернуть его описание (не код). Например, строку "**МСМК**" (без кавычек).
  + В случае, если не выполнен никакой норматив, необходимо из функции вернуть '' (пустую строку).
