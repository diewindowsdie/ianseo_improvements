# Список изменений относительно коробочной, "ванильной" версии IANSEO rev 26:
## Список изменений ianseo_improvements_2024-12-08_rev26_v2.0:
* Изменена структура папок с классами, связанными с вычислением выполненного спортсменом норматива. Описание работы с нормативами ниже также было обновлено и содержит корректные названия папок.
* Изменена модель судей - добавлено отчество, имеющаяся судейская категория и флаг, указывающий на то, подписывает ли данный судья протокол соревнований.
* В список поддерживаемых судейских должностей добавлены "Главный секретарь", "Заместитель главного секретаря", "Секретарь", "Судья технической комиссии".
* Добавлена генерация "судейской справки" с автоматической сортировкой судей:
  + Сначала те, кто подписывают протокол, отсортированные по судейской должности, категории, фамилии и имени;
  + Далее, все остальные судьи сортируются сначала по должности, потом по судейской категории и затем по фамилии и имени;
* Реализован автоподбор высоты строк отчета "Судейская коллегия" (судейская справка) для предотвращения ситуации, когда блок подписей ГСК находится на отдельной странице, в то время как сам отчет - на предыдущей.
* Добавлена локализация на русский язык некоторых судейских должностей.
* Блок с полями для подписей ГСК строится на основании указанной информации о судьях, у которых стоит галочка "Подписывает протокол". Если таких судей меньше трех - блок не выводится. Если их трое и больше - берем первых трех в соответствии с сортировкой, описанной выше.
* При добавлении судьи через интерфейс ianseo теперь не нужно указывать полное название региона, если участники или судьи с этого региона уже были добавлены, достаточно указать код региона.
* В интерфейсе работы с судьями название поля "Регион/Команда" заменено на "Субъект РФ".
* Для страниц протокола с ландшафтной ориентацией сделан автоматический расчет ширины полей под подписи судей ГСК и интервала между ними.
* Добавлено отображение IRM-статусов и комментариев к ним в отчет об индивидуальной квалификации и в индивидуальные "лесенки". 
Пример: если человек был дисквалифицирован в квалификации, мы можем поставить ему статус DSQ с комментарием, этот комментарий будет отображаться в правой части таблицы с результатами квалификации, и вместо всех "финалов" в лесенках.
Другой пример: человек не начал стрельбу в 1/4 финала, ставим ему статус DNS и комментарий, результат 1/8 у человека будет, но правее него будет показан выставленный комментарий к IRM-статусу.
* К индивидуальным лесенкам снизу добавлена легенда IRM-статусов.
* В индивидуальном и командном отчете "Отборочный и финальный - сетки и ранги" по умолчанию включен показ пробоин в сетках.
* Исправлена ширина столбцов в заголовке второй и последующих страниц списка медалистов.
* Исправлено форматирование времени в списке медалистов.
* Исправлено форматирование дат в заголовке и нижней части всех страниц отчетов.
* Увеличены отступы от шапки во всех страницах всех отчетов
* Длина поля "Код соревнования" увеличена до 15 символов.
* При импорте соревнования по умолчанию выставлен фильтр на файлы .ianseo для облегчения поиска нужно файла.
* Исправлена работа формы обновления названий регионов, теперь введенные названия корректно сохраняются.
* В личных сетках, "лесенках" и списке медалистов не используем название эвента (например Блочный лук Мужчины), а склеиваем название из названия дивизиона и названия класса.
* Добавлен один общий заголовок перед отчетом с личной квалификацией.
* Исправлено отображение легенды комментариев о жеребьевке и перестрелках, а также легенды IRM-статусов под отчетом о личной квалификации.
* Исправлен баг с падением отчета о квалификации, когда у какого-то спортсмена не указан день рождения.
* В индивидуальной квалификации, списке медалистов и индивидуальных "лесенках" в качестве региона/команды отображается конкатенация через запятую названия региона 1, 2 и 3 для данного спортсмена, если они заполнены. 
В связи с этим рекомендуется указывать в данные поля информацию от более общей к более частной, например в поле Регион/Команда 1 - регион спортсмена, в поле 2 - спортивная школа или организация, и так далее. 
* Реализовано вычисление ширины столбца с именем спортсмена в "лесенках" на основании самых "больших" финалов и максимальных длин имени спортсмена и выводимого названия региона/команды.
* Добавлен небольшой интервал между текстом в заголовке листов отчетов и правым изображением.
* В отчете "Статистика по регионам" коды классов и дивизионов заменены на их названия.
* К отчету "Статистика по регионам" внизу добавлен блок для подписей ГСК.
* Реализован автоподбор высоты строк отчета "Статистика по регионам" для предотвращения ситуации, когда блок подписей ГСК находится на отдельной странице, в то время как сам отчет - на предыдущей.
* Добавлена возможность построения отчета "Статистика по регионам" (только как часть общего протокола соревнования) по полям "Регион/Команда 2" и "Регион/Команда 3".
* Добавлена возможность указать заголовок отчета "Статистика по регионам", в соответствии с тем, какого рода данные лежат в соответствующем поле (см. предыдущий пункт).
* Добавлена возможность сформировать итоговый протокол соревнования, объединив различные отчеты. Формирование протокола доступно в меню Соревнование - Заключительный отчет - Распечатать протокол соревнований.
* Протокол соревнований состоит из:
  + Список медалистов;
  + Результаты индивидуальной квалификации (если в соревновании настроены индивидуальные эвенты);
  + Результаты командной квалификации (если в соревновании настроены командные эвенты);
  + Индивидуальные сетки и лесенки (если в соревновании настроены индивидуальные эвенты);
  + Командные сетки и лесенки (если в соревновании настроены командные эвенты);
  + Статистика по регионам по полю "Регион/Команда 1" (если соответствующая галочка была включена при формировании протокола); 
  + Статистика по регионам по полю "Регион/Команда 2" (если соответствующая галочка была включена при формировании протокола);
  + Статистика по регионам по полю "Регион/Команда 3" (если соответствующая галочка была включена при формировании протокола);
  + Состав судейской коллегии (судейская справка);
Примечание - отчеты о командной квалификации, командные сетки и лесенки на данный момент не менялись, они будут выглядеть так же, как в оригинальной версии IANSEO.


## Список изменений ianseo_improvements_2024-12-08_rev26_v1.1:
* Добавлена возможность получить список медалистов, результаты личной квалификации, сетки и "лесенки" в виде одного PDF-файла.
В разделе Индивидуальные финалы -> Распечатки в форме внизу слева добавлены галочки, управляющие появлением списка медалистов и результатов индивидуальной квалификации в документе.

## Список изменений ianseo_improvements_2024-12-08_rev26_v1.0:
### Изменения отчета "Результаты квалификационного раунда (индивидуальный)":
* Изменено соотношение размеров полей - ширина поля "Регион/Команда" увеличена
* В поле "Регион/Команда" не выводится код региона, а через запятую выводится первый и второй указанный для участника регион
* Добавлено поле с датой рождения спортсмена
* В поле "Разряд" выводится описание (не код, как было из коробки) текущего имеющегося спортивого разряда/звания спортсмена (см. ниже общее описание работы с имеющимися разрядами)
* Убрано поле с классом/возрастным классом спортсмена (U18M, U21W и т.д.)
* Добавлено поле с выполненным нормативом (см. общее описание работы с нормативами ниже)
* В конце отчета добавлен блок с подписями, именами и судейскими категориями судей ГСК (см. общее описание работы с судьями ГСК ниже)
* В том случае если последняя группа+дивизион в отчете расположена так, что подписи ГСК и блок с легендой не помещаются, последняя группа+дивизион переносится на новую страницу
* В конце отчета в блок легенды добавлено описание статусов DNS, DNF, DSQ, DQB

### Изменения отчета "Отборочный и финальный этап - сетки и ранги (индивидуальный)":
* Локализован вывод номеров щитов - теперь они выглядят так: "Щит 2"/"Щит 3А" и т. д.
* Таблицы с финальными рангами теперь выводятся одна за другой, больше не выводятся по одной группе/дивизиону на страницу
* Перед первой таблицей добавлен заголовок "Итоговые результаты"
* В таблицах с итоговыми результатами изменено соотношение размеров полей - ширина поля "Регион/Команда" увеличена, также увеличена ширина ячеек под результаты каждого поединка
* Для классиков, занявших с 5 по 8 место, сумма результатов попаданий в поединке теперь выводится справа от количества очков в поединке
* В таблицах с итоговыми результатами выводятся результаты перестрелок в каждом поединке (были только за золото и бронзу)
* В таблицах с итоговыми результатами в поле "Регион/Команда" не выводится код региона, а через запятую выводится первый и второй указанный для участника регион
* При выводе результатов перестрелок при одинаковых попаданиях теперь выводится "+" рядом с тем результатом, который был ближе к центру
* После таблиц с итоговыми результатами добавлен блок с подписями, именами и судейскими категориями судей ГСК (см. общее описание работы с судьями ГСК ниже)
* В случае, если последняя таблица с итоговыми результатами расположена так, что подписи ГСК окажутся на другой странице, последняя таблица с итоговыми результатами переносится на новую страницу

### Изменения отчета "Список медалистов":
* Изменено соотношение ширины полей - уменьшена ширина полей "Дата", "Медаль" и "Спортсмен", и увеличена ширина поля "Команда/Регион"
* В поле "Регион/Команда" не выводится код региона, а через запятую выводится первый и второй указанный для участника регион
* В конце отчета добавлен блок с подписями, именами и судейскими категориями судей ГСК (см. общее описание работы с судьями ГСК ниже)
* Локализован заголовок отчета - выводится "Список победителей и призеров"

### Изменения отчета "Список спортсменов по мишеням"
* Добавлен заголовок "Протокол жеребьёвки"
* Убрано поле с идентификатором спортсмена
* Добавлено поле с датой рождения спортсмена
* В поле "Регион/Команда" не выводится код региона, а через запятую выводится первый и второй указанный для участника регион. Также, название региона больше не пишется полностью заглавными буквами.
* В полях "Класс" и "Дивизион" выводятся заданные в настройках соревнования значения, вместо кодов.
* В поле "Разряд" выводится описание (не код, как было из коробки) текущего имеющегося спортивого разряда/звания спортсмена (см. ниже общее описание работы с имеющимися разрядами)

### Изменения отчета "Полное расписание"
* Локализованы заголовки отчета: "Программа соревнований" и "Расписание"
* Локализованы даты в заголовке отчета - дата соревнования форматируется без английского сокращенного названия месяца

### Прочие изменения
* Изменена локализация полей в настройках классов/дивизионов - поля для ввода максимального и минимального возраста возрастного класса называются теперь "Мин. возраст" и "Макс. возраст"
* Добавлена поддержка двойных кавычек в названии стран, клубов и команд. Одинарные кавычки не поддерживаются.

### Работа с судьями ГСК
* Локализованы названия должностей судей ГСК.
* Блок для подписей судей ГСК строится на основании информации, указанной в настройках соревнования: Соревнование -> Изменить инф. о турнире -> Судейская коллегия.
* Необходимо добавить трех или более судей, и указать для нужных галочку "Подписывает протокол".
* Остальные поля заполняются интуитивно понятно. Рекомендуется в качестве кода региона использовать тот же код, что используется для этого региона у спортсменов.

### Работа с имеющимися спортивными разрядами и званиями спортсменов
* В настройках соревнования: Соревнование -> Изменить инф. о турнире -> Разряд/Звание необходимо внести латиницей коды имеющихся разрядов и кириллицей их описание (для отчета с квалификации), при этом не забывая указывать порядок. В каком порядке они добавлены, значения не имеет, главное чтобы значения в поле "Порядок" не повторялись.
* Пример пар ключ-значение (жирным выделен ключ):
  + **1**	1
  + **2**	2
  + **3**	3
  + **1U**  1ю
  + **2U**  2ю
  + **3U**  3ю
  + **K**	КМС
  + **M**	МС
  + **MM**	МСМК
  + **Z**	ЗМС
  + **NO**  б/р
* После того как были добавлены коды и описания разрядов, эти коды необходимо использовать при импорте данных спортсменов в IANSEO. Обращаю внимание, именно коды, а не значения. Если все сделано верно - данные появятся в отчете с квалификации.

### Работа с выполненными нормативами
* Спортивные нормативы гибко настраиваются. На данный момент поддерживаются нормативы для упражнения 18м+18м и 12м+12м.
* Для добавления поддержки нормативов для других упражнений:
  + Найти папку ***Common/Lib/Normative/conf***, в которой лежат файлы с настройками.
  + Определить уникальную для данного набора дистанций строку: для этого необходимо проверить, как для выбранного упражнения в IANSEO называются дистанции. Например: для 18м+18м это **18m-1** и **18m-2**. Имя файла должно быть соединением этих названий через символ подчеркивания "_", с заменой дефисов "-" на символ подчеркивания "_". Получаем строку "**18m_1_18m_2**" (без кавычек).
  + Создать файл с корректным именем: к полученной ранее строке нужно добавить "**Provider**" спереди и "**.inc.php**" (без кавычек) сзади. В нашем примере получится имя файла "**Provider18m_1_18m_2.inc.php**".
  + Внутри этого файла необходимо написать на PHP класс, реализующий интерфейс ***NormativeProvider***. Имя этого класса должно начинаться со слова "**Provider**" (без кавычек), к которому необходимо дописать справа строку, полученную ранее. Для нашего примера получим "**Provider18m_1_18m_2**". Другой пример: для упражнения М-1 для мужчин это будет "**Provider90m_70m_50m_30m**".
  + В этом классе необходимо реализовать функцию ***calculateNormativeInternal***, принимающую три параметра: ***\$class***, ***\$division***, ***\$score***. Сигнатуру функции можно копировать из имеющихся реализаций. Эта функция и осуществляет определение выполненного норматива.
  + **В настройках соревнования и здесь необходимо использовать стандартные коды классов и дивизионов - R, C, B для дивизионов, M, W, U18M, U18W, U21M, U21W, U14M, U14W для классов.**
  + В поле ***$division*** будет идентификатор дивизиона, указанный в настройках соревнования, обычно это **R** для классического лука, **С** (латинская) для блочного лука, **B** для баребоу, и т.д.
  + В поле ***$class*** будет класс, в который входит возрастная категория и пол лучника, как было указано в настройках соревнования. Обычно это может быть **U18M** - для юноши, **U21W** - для юниорки, **M** для мужчины.
  + В поле ***$score*** будет число с результатом лучника.
  + На основании этих данных необходимо рассчитать выполненный норматив. Обращаем внимание на то, что для некоторых упражнений нормативы не присваиваются некоторым категориям лучников. Например, на "женском" М-1 - 70+60+50+30, который также стреляют юноши, мужчинам разряды и звания не присваиваются, а нормативы для юношей и женщин отличаются.
  + В случае, если выполнен норматив, необходимо вернуть его описание (не код). Например, строку "**МСМК**" (без кавычек).
  + В случае, если не выполнен никакой норматив, необходимо из функции вернуть '' (пустую строку).
